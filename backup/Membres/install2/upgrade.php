<?php 
/*****************************************************************
*    MDS Installer for Advanced Member System                    *
*    Copyright (c) 2013 MasDyn Studio, All Rights Reserved.      *
*****************************************************************/
ob_start();ob_clean();session_start();$jvecspty0="upgrade.php";$whpbjgzg1="Advanced Member System";$kftuojjt2="3.5";$madilgzy3="3";function preprint($chsnthro4){echo "<pre>";print_r($chsnthro4);echo "</pre>";}function clean_value($kacdmqkb5){global $hezpvbwf6;return preg_replace("/[^0-9a-z_ ,.(){}-]/i","",trim($kacdmqkb5));}function create_salt($dzqytgdu7=25){$wgfsduao8=array_merge(range('A','Z'),range('a','z'),range(0,9));$arbdyrqi9='';for($izrhkouf10=0;$izrhkouf10<$dzqytgdu7;$izrhkouf10++){$arbdyrqi9.=$wgfsduao8[mt_rand(0,count($wgfsduao8)-1)];}return $arbdyrqi9;}function encrypt_password($wmuhmmen11,$jcpizgqt12=""){$nuybpnmq13=10;if($jcpizgqt12==""){$jcpizgqt12=$_SESSION['installer']['upgrade']['core']['DATABASE_SALT'];}$psjarjqf14=crypt($wmuhmmen11,$jcpizgqt12);for($kchcrors15=0;$kchcrors15<$nuybpnmq13;++$kchcrors15){$psjarjqf14=crypt($psjarjqf14.$wmuhmmen11,$jcpizgqt12);}return $psjarjqf14;}function generate_id($wtdbxdzk16=6){$vcnguiia17='';for($kchcrors15=0;$kchcrors15<$wtdbxdzk16;$kchcrors15++){$vcnguiia17.=rand(1,9);}return $vcnguiia17;}if(!isset($_SESSION['installer']['upgrade']['message'])){$aczecbiq18="";}else{$aczecbiq18=$_SESSION['installer']['upgrade']['message'];unset($_SESSION['installer']['upgrade']['message']);}if(!isset($_SESSION['installer']['upgrade'])){$_SESSION['installer']['upgrade']['step']=1;$_SESSION['installer']['upgrade']['completed']=array();}if(!isset($_GET['step'])){$gwyvinzv19=1;}else{$gwyvinzv19=$_GET['step'];}$dsaaexud20=$_SESSION['installer']['upgrade']['step'];if($gwyvinzv19>$dsaaexud20){header("location: upgrade.php?step=$dsaaexud20");}if($gwyvinzv19==1){$jvecspty0="upgrade.php?step=1";if(isset($_POST['submit'])){$pungjrqe21=$_POST['host'];$prrdavnx22=$_POST['user'];$ucewbbaf23=$_POST['pass'];$hezpvbwf6=$_POST['database'];$dvdgynru24=false;if($pungjrqe21!="" &&$prrdavnx22!="" &&$hezpvbwf6!=""){$pseonynd25=mysql_connect($pungjrqe21,$prrdavnx22,$ucewbbaf23);if(!$pseonynd25){$aczecbiq18="<div class='alert alert-error'><button type='button' class='close' data-dismiss='alert'>×</button>Could not connect: ".mysql_error()."</div>";$dvdgynru24=true;}else{$kfnbgczz26=mysql_select_db($hezpvbwf6,$pseonynd25);if(!$kfnbgczz26){$aczecbiq18="<div class='alert alert-error'><button type='button' class='close' data-dismiss='alert'>×</button>Can't use $hezpvbwf6: ".mysql_error()."</div>";$dvdgynru24=true;}}if($dvdgynru24===false){$_SESSION['installer']['upgrade']['database']=array('host' =>$pungjrqe21,'user' =>$prrdavnx22,'pass' =>$ucewbbaf23,'database' =>$hezpvbwf6);$_SESSION['installer']['upgrade']['step']=2;$_SESSION['installer']['upgrade']['completed'][]=1;$_SESSION['installer']['upgrade']['message']="<div class='alert alert-success'><button type='button' class='close' data-dismiss='alert'>×</button>Successfully connected to database: <strong>$hezpvbwf6</strong>.</div>";header("location: upgrade.php?step=2");}}else{$aczecbiq18="<div class='alert alert-error'><button type='button' class='close' data-dismiss='alert'>×</button>Please complete all required fields.</div>";}}else{if(isset($_SESSION['installer']['upgrade']['database'])){$pungjrqe21=$_SESSION['installer']['upgrade']['database']['host'];$prrdavnx22=$_SESSION['installer']['upgrade']['database']['user'];$ucewbbaf23=$_SESSION['installer']['upgrade']['database']['pass'];$hezpvbwf6=$_SESSION['installer']['upgrade']['database']['database'];}else{$pungjrqe21="";$prrdavnx22="";$ucewbbaf23="";$hezpvbwf6="";}}}else if($gwyvinzv19==2){$jvecspty0="upgrade.php?step=2";if(isset($_POST['submit'])){$vkuefohh27=null;$pungjrqe21=$_SESSION['installer']['upgrade']['database']['host'];$prrdavnx22=$_SESSION['installer']['upgrade']['database']['user'];$ucewbbaf23=$_SESSION['installer']['upgrade']['database']['pass'];$hezpvbwf6=$_SESSION['installer']['upgrade']['database']['database'];$pseonynd25=mysql_connect($pungjrqe21,$prrdavnx22,$ucewbbaf23);if(!$pseonynd25){die('Could not connect: '.mysql_error());}$kfnbgczz26=mysql_select_db($hezpvbwf6,$pseonynd25);if(!$kfnbgczz26){die('Can\'t use '.$hezpvbwf6.' : '.mysql_error());}mysql_select_db($hezpvbwf6,$pseonynd25);foreach(file("upgrade.sql") as $uvygvgtb28){mysql_query($uvygvgtb28);}if(!mysql_query("SELECT invited_by FROM users")){mysql_query("ALTER TABLE users ADD salt VARCHAR(255) AFTER invited_by");}if(!mysql_query("SELECT oauth_provider FROM users")){mysql_query("ALTER TABLE users ADD oauth_provider ENUM('0', '1') DEFAULT '0' AFTER salt");}if(!mysql_query("SELECT oauth_uid FROM users")){mysql_query("ALTER TABLE users ADD oauth_uid TEXT AFTER oauth_provider");}if(!mysql_query("SELECT login_count FROM users")){mysql_query("ALTER TABLE users ADD login_count bigint(20) unsigned NOT NULL AFTER oauth_uid");}if(!mysql_query("SELECT THEME_NAME FROM core_settings")){mysql_query("INSERT INTO core_settings VALUES ('THEME_NAME', 'mds_light') ");}if(!mysql_query("SELECT BRUTEFORCE_LIMIT FROM core_settings")){mysql_query("INSERT INTO core_settings VALUES ('BRUTEFORCE_LIMIT', '5') ");}if(!mysql_query("SELECT BRUTEFORCE_TIMEOUT FROM core_settings")){mysql_query("INSERT INTO core_settings VALUES ('BRUTEFORCE_TIMEOUT', '15') ");}if(!mysql_query("SELECT CAPTCHA FROM core_settings")){mysql_query("INSERT INTO core_settings VALUES ('CAPTCHA', 'OFF') ");}if(!mysql_query("SELECT CAPTCHA_TYPE FROM core_settings")){mysql_query("INSERT INTO core_settings VALUES ('CAPTCHA_TYPE', '0') ");}if(!mysql_query("SELECT PP_SERVICE_PURCHASE FROM core_settings")){mysql_query("INSERT INTO core_settings VALUES ('PP_SERVICE_PURCHASE', 'NO') ");}if(!mysql_query("SELECT PUSALT FROM core_settings")){mysql_query("INSERT INTO core_settings VALUES ('PUSALT', 'NO') ");}if(!mysql_query("SELECT OAUTH FROM core_settings")){mysql_query("INSERT INTO core_settings VALUES ('OAUTH', 'OFF') ");}if(!mysql_query("SELECT ADMIN_LEVEL FROM core_settings")){mysql_query("INSERT INTO core_settings VALUES ('ADMIN_LEVEL', '293847') ");}mysql_close($pseonynd25);$_SESSION['installer']['upgrade']['step']=3;$_SESSION['installer']['upgrade']['completed'][]=2;$_SESSION['installer']['upgrade']['message']="<div class='alert alert-success'><button type='button' class='close' data-dismiss='alert'>×</button>Your database <strong>$hezpvbwf6</strong> has been successfully upgraded.</div>";header("location: upgrade.php?step=3");}}else if($gwyvinzv19==3){$jvecspty0="upgrade.php?step=3";$vkuefohh27=null;if(isset($_POST['submit'])){$_SESSION['installer']['upgrade']['step']=4;$_SESSION['installer']['upgrade']['completed'][]=3;header("location: upgrade.php?step=4");}}else if($gwyvinzv19==4){$jvecspty0="upgrade.php?step=4";$vkuefohh27=null;if(isset($_POST['submit'])){$_SESSION['installer']['upgrade']['step']=5;$_SESSION['installer']['upgrade']['completed'][]=4;header("location: upgrade.php?step=5");}}?>
<!DOCTYPE html><html lang="en"> <head> <meta charset="utf-8"> <title>MDS Installer - <?php echo $whpbjgzg1;?></title> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="author" content="MasDyn Studio"> <!-- The styles --> <link href="css/bootstrap.css" rel="stylesheet"> <link href="css/bootstrap-responsive.css" rel="stylesheet"> <link href="css/custom.css" rel="stylesheet"> <style> body{ margin-top: 5%; } </style> <!-- The HTML5 shim, for IE6-8 support of HTML5 elements --> <!--[if lt IE 9]> <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script> <![endif]--> <!-- the fav and touch icons --> <link rel="shortcut icon" href="ico/favicon.ico"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="ico/apple-touch-icon-114-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png"> <link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png"> <script src="js/jquery.js"></script> <script src="js/custom.js"></script> </head> <body> <div class="container"><div class="hero-unit"> <h1>MDS Installer - Upgrade to <?php echo $whpbjgzg1;?> <span class="script_version">v<?php echo $kftuojjt2;?></span></h1> <hr /> <div class="row-fluid"> <div class="span3 nav_container"> <ul class="nav nav-tabs nav-stacked"> <li<?php if($gwyvinzv19==1){echo ' class="active"';}?>><a href="upgrade.php?step=1">Database Connection<?php if(in_array(1,$_SESSION['installer']['upgrade']['completed'])){echo '<img src="img/tick.png" height="20px" style="margin: -5px 0px 0px 5px;">';}?></a></li> <li<?php if($gwyvinzv19==2){echo ' class="active"';}?>><a href="upgrade.php?step=2">Upgrade Database<?php if(in_array(2,$_SESSION['installer']['upgrade']['completed'])){echo '<img src="img/tick.png" height="20px" style="margin: -5px 0px 0px 5px;">';}?></a></li> <li<?php if($gwyvinzv19==3){echo ' class="active"';}?>><a href="upgrade.php?step=3">Replace Files<?php if(in_array(3,$_SESSION['installer']['upgrade']['completed'])){echo '<img src="img/tick.png" height="20px" style="margin: -5px 0px 0px 5px;">';}?></a></li> <li<?php if($gwyvinzv19==4){echo ' class="active"';}?>><a href="upgrade.php?step=4">Update Files<?php if(in_array(4,$_SESSION['installer']['upgrade']['completed'])){echo '<img src="img/tick.png" height="20px" style="margin: -5px 0px 0px 5px;">';}?></a></li> <li<?php if($gwyvinzv19==5){echo ' class="active"';}?>><a href="upgrade.php?step=4">Upgrade Complete<?php if(in_array(5,$_SESSION['installer']['upgrade']['completed'])){echo '<img src="img/tick.png" height="20px" style="margin: -5px 0px 0px 5px;">';}?></a></li> </ul> </div> <div class="span9 content"> <div id="message"><?php echo $aczecbiq18;?></div> <?php if($gwyvinzv19==1){?> <form action="<?php echo $jvecspty0;?>" method="POST"> <div class="row-fluid"> <div class="span3"> <label>Host<em class="req">*</em></label> <input type="text" name="host" class="span12" value="<?php echo htmlentities($pungjrqe21);?>" /> </div> <div class="span3"> <label>Username<em class="req">*</em></label> <input type="text" name="user" class="span12" value="<?php echo htmlentities($prrdavnx22);?>" /> </div> <div class="span3"> <label>Password</label> <input type="password" name="pass" class="span12" value="<?php echo htmlentities($ucewbbaf23);?>" /> </div> <div class="span3"> <label>Database Name<em class="req">*</em></label> <input type="text" name="database" class="span12" value="<?php echo htmlentities($hezpvbwf6);?>" /> </div> </div> <div class="form-actions" style="text-align: center;"> <a href="upgrade.php?step=1" class="btn btn-primary">Back</a> <input class="btn btn-success" type="submit" name="submit" value="Connect to Database" /> </div> </form> <?php }else if($gwyvinzv19==2){?> <form action="<?php echo $jvecspty0;?>" method="POST"> <div class="row-fluid"> <div class="span12"> Clicking the <strong>"Upgrade Database"</strong> button <strong>WILL NOT</strong> delete any of the data inside of <strong><?php echo $_SESSION['installer']['upgrade']['database']['database'];?></strong>. But to be safe, please make sure that you have a backup copy. <br /><br />Before continuing, please make sure you have selected the correct database. <br /><br /> The next step could take a couple of minutes to complete, so please be patient. </div> </div> <div class="form-actions" style="text-align: center;"> <a href="upgrade.php?step=1" class="btn btn-primary">Back</a> <input class="btn btn-success" type="submit" name="submit" value="Upgrade Database" /> </div> </form> <?php }else if($gwyvinzv19==3){?> <form action="<?php echo $jvecspty0;?>" method="POST"> If you current installed version if prior to version 3.5, please replace all files apart from "includes/configuration/config.php". <div class="form-actions" style="text-align: center;"> <a href="upgrade.php?step=2" class="btn btn-primary">Back</a> <input class="btn btn-success" type="submit" name="submit" value="I've replaced all above files" /> </div> </form> <?php }else if($gwyvinzv19==4){?> <form action="<?php echo $jvecspty0;?>" method="POST"> Please add the following code to "includes/configuration/config.php" if it is not already present. <pre>defined("IMAGES") ? null : define("IMAGES", WWW."includes/themes/".THEME_NAME."/img/"); date_default_timezone_set(TIMEZONE);defined("RECAPTCHA_PUBLIC") ? null : define("RECAPTCHA_PUBLIC", "HERE");defined("RECAPTCHA_PRIVATE") ? null : define("RECAPTCHA_PRIVATE", "HERE");defined("AUTHPATH") ? null : define("AUTHPATH", "/auth/");defined("AUTHSALT") ? null : define("AUTHSALT", "PASTE_RANDOM_CODE_HERE");defined("FACEBOOK_APP_ID") ? null : define("FACEBOOK_APP_ID", "");defined("FACEBOOK_APP_SECRET") ? null : define("FACEBOOK_APP_SECRET", "");defined("TWITTER_CONSUMER_KEY") ? null : define("TWITTER_CONSUMER_KEY", "");defined("TWITTER_CONSUMER_SECRET") ? null : define("TWITTER_CONSUMER_SECRET", "");defined("GOOGLE_CLIENT_ID") ? null : define("GOOGLE_CLIENT_ID", "");defined("GOOGLE_CLIENT_SECRET") ? null : define("GOOGLE_CLIENT_SECRET", ""); </pre> <div class="form-actions" style="text-align: center;"> <a href="upgrade.php?step=2" class="btn btn-primary">Back</a> <input class="btn btn-success" type="submit" name="submit" value="I've made all of the above alterations" /> </div> </form> <?php }else if($gwyvinzv19==5){unset($_SESSION['installer']['upgrade']);$_SESSION['installer']['upgrade']['step']=1;$_SESSION['installer']['upgrade']['completed']=array();?> <div class="row-fluid center"> <div class="span12"> <label><?php echo $whpbjgzg1;?> has been successfully upgraded to the latest version. If you have any questions please feel free to <a href="http://www.masdyn.com/support/">Contact Us</a>.</label> </div> </div> <div class="row-fluid center"> <div class="span12"> <label>Please delete the "install" directory before continuing.</label> </div> </div> <div class="form-actions" style="text-align: center;"> <a href="../index.php" class="btn btn-primary">Visit Site</a> </div> <?php }?> </div> </div> </div> <footer> <p style="float:left;">&copy; <?php echo date("Y");?> MasDyn Studio - <a href="http://www.masdyn.com/">MasDyn.com</a></p> <span style="text-align:right;float:right;font-size:12px">Installer Version: <?php echo $madilgzy3;?></span> </footer> </div> <!-- /container --> <script src="js/bootstrap.min.js"></script> </body> </html>